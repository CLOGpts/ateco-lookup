# 📋 STATO PROGETTO ATECO-LOOKUP - ESTRAZIONE VISURE

## 🎯 OBIETTIVO
Implementare endpoint `/api/extract-visura` per estrarre dati da PDF di visure camerali.

## ✅ COSA ABBIAMO FATTO
1. **Risolto problema Python 3.13** (commit `9a1eb08`):
   - Spostati import FastAPI a livello globale per evitare ForwardRef error
   - Deploy su Render ora funziona

2. **Implementato sistema estrazione visure**:
   - `visura_extractor.py`: Classe per estrarre dati da PDF (ATECO, oggetto sociale, sedi, tipo business)
   - Endpoint `/api/extract-visura` in `ateco_lookup.py`
   - Aggiunto `pdfplumber` a requirements.txt

3. **Aggiunto logging dettagliato** (commit `a00d92b`):
   - Log per debug import VisuraExtractor
   - Traceback completo in caso di errori
   - Check esplicito presenza pdfplumber

## ❌ PROBLEMA ATTUALE
**Errore 500 su endpoint `/api/extract-visura`**:
- Il deploy funziona ma l'endpoint restituisce Internal Server Error
- Probabilmente `VisuraExtractor` non viene importato correttamente su Render
- Possibili cause:
  1. `pdfplumber` non installato correttamente
  2. Dipendenze mancanti di pdfplumber
  3. Problemi di permessi o path su Render

## 🔍 PROSSIMI PASSI
1. **Verificare log Render dopo deploy** con nuovo logging dettagliato
2. **Se pdfplumber manca**, verificare che sia in requirements.txt (già presente)
3. **Se dipendenze mancano**, potrebbe servire aggiungere:
   ```
   Pillow>=9.0.0
   pdfminer.six>=20211012
   ```
4. **Alternative se pdfplumber non funziona su Render**:
   - Usare PyPDF2 (più leggero ma meno accurato)
   - Usare un servizio esterno per parsing PDF
   - Implementare parsing lato client

## 📂 FILE PRINCIPALI
- `ateco_lookup.py`: Backend FastAPI con endpoint
- `visura_extractor.py`: Logica estrazione dati da PDF  
- `requirements.txt`: Dipendenze (include pdfplumber)
- Frontend React già pronto per usare l'endpoint

## 🚀 STATO DEPLOY
- **Ultimo commit pushato**: `a00d92b` - logging dettagliato
- **Branch**: main
- **URL Render**: https://ateco-lookup.onrender.com
- **Endpoint problematico**: POST /api/extract-visura

## 💡 NOTE
Il sistema è progettato per:
1. Ricevere PDF visura (max 20MB)
2. Estrarre codici ATECO, oggetto sociale, sedi
3. Inferire tipo business (B2B/B2C)
4. Arricchire con dati dal mapping ATECO

Quando il problema sarà risolto, l'utente potrà caricare visure e ottenere automaticamente tutti i dati strutturati.